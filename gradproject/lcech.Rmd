---
title: "grad project"
output: html_notebook
author: Laura Cech
---

intro
https://opendata.maryland.gov/Business-and-Economy/Baltimore-County-Real-Property-Assessments-Hidden-/jpfc-qkxp

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r}
library(tidyverse)
library(refinr)
library(janitor)
library(lubridate)
library(readxl)
library(datasets)
library(dplyr)
```

```{r}
property_all <- read_csv("data/Baltimore_County_Real_Property_Assessments.csv")
```

```{r}
property_all <-property_all|>
  clean_names()
```
```{r}
property_filtered <- property_all %>% 
  select(mappable_latitude_and_longitude, mdp_street_address_mdp_field_address, mdp_street_address_city_mdp_field_city, mdp_street_address_zip_code_mdp_field_zipcode, land_use_code_mdp_field_lu_desclu_sdat_field_number_50, property_factors_utilities_water_mdp_field_pfuw_sdat_field_number_63, property_factors_utilities_sewer_mdp_field_pfus_sdat_field_number_64, property_factors_location_waterfront_mdp_field_pflw_sdat_field_number_65, property_factors_street_unpaved_mdp_field_pfsu_sdat_field_number_68, property_factors_influence_historical_mdp_field_pfih_sdat_field_number_70, sales_segment_1_grantor_name_mdp_field_grntnam1_sdat_field_number_80, sales_segment_3_how_conveyed_ind_sdat_field_number_127, 
sales_segment_2_grantor_name_sdat_field_number_100, 
sales_segment_3_grantor_name_sdat_field_number_120, additional_c_a_m_a_data_building_style_code_and_description_mdp_field_strustyl_descstyl_sdat_field_number_264  )
```

#Note on the columns I pulled: I did not look at prices at this juncture and only looked at the type of the most recent sale. There are too many things to examine and the file is huge!

```{r}
#rename columns
property_renamed <-property_filtered |>
  rename(map_coordinates = mappable_latitude_and_longitude) |>
  rename(street = mdp_street_address_mdp_field_address) |>
  rename(city = mdp_street_address_city_mdp_field_city) |>
  rename(zip = mdp_street_address_zip_code_mdp_field_zipcode) |>
  rename(land_code = land_use_code_mdp_field_lu_desclu_sdat_field_number_50) |>
  rename(water = property_factors_utilities_water_mdp_field_pfuw_sdat_field_number_63) |>
  rename(sewer = property_factors_utilities_sewer_mdp_field_pfus_sdat_field_number_64) |>
  rename(waterfront = property_factors_location_waterfront_mdp_field_pflw_sdat_field_number_65) |>
  rename(unpaved = property_factors_street_unpaved_mdp_field_pfsu_sdat_field_number_68) |>
  rename(historical = property_factors_influence_historical_mdp_field_pfih_sdat_field_number_70) |>
  rename(sales1 = sales_segment_1_grantor_name_mdp_field_grntnam1_sdat_field_number_80) |>
  rename(sales2 = sales_segment_2_grantor_name_sdat_field_number_100) |>
  rename(sales3 = sales_segment_3_grantor_name_sdat_field_number_120) |>
  rename(conveyed3 = sales_segment_3_how_conveyed_ind_sdat_field_number_127) |>
  rename(bldg = additional_c_a_m_a_data_building_style_code_and_description_mdp_field_strustyl_descstyl_sdat_field_number_264)
  
```

What does the data look like by city?
I can see that some places will show up as "Baltimore" because it's interchangable in some places like Catonsville.

```{r}
#group by cities
by_city <- property_renamed|>
   group_by(city) |>
  summarise(count = n()) |>
  arrange(desc(count))
```


What percentage of this data involves properites with historical influence?
I'm surprised only 4 are in this category, but sure makes it easy to find out more about them and see if there's a story there.

```{r}
#see historical properties
historical_count <- property_renamed |> 
  filter(!str_detect(historical, "No Historical Influence \\(0\\)")) 

print(historical_count)
```

Let's look at waterfront property.
Only about 5,000 (less than 2 percent) of the 305,205 records are classified as waterfront.
Obviously, the majority are in Eastern Baltimore County (Dundalk, Middle River, Essex).

See the by-the-city visualization: https://datawrapper.dwcdn.net/eimgT/1/



```{r}
waterfront_total <- property_renamed |>
  filter(!str_detect(waterfront, "None \\(0\\)")) |>
  nrow()

#total records
total_records <- nrow(property_renamed )

#get percentage 
percentage_waterfront <- (waterfront_total / total_records) * 100

print(percentage_waterfront)
```

```{r}
waterfront_counts_by_city <- property_renamed |>
  filter(!str_detect(waterfront, "None \\(0\\)")) |>
  group_by(city, land_code) |>
  summarise(count = n()) |>
  arrange(desc(city))


print(waterfront_counts_by_city)

# Export csv
write.csv(waterfront_counts_by_city, "waterfront_counts_by_city.csv", row.names = FALSE)

```
```{r}
#see land code percentages by city

waterfront_counts_by_city_landcode <- property_renamed |>
  filter(!str_detect(waterfront, "None \\(0\\)")) |>
  group_by(city, land_code) |>
  summarise(count = n()) |>
  arrange(desc(city))

total_counts_by_city <- waterfront_counts_by_city_landcode |>
  group_by(city) |>
  summarise(total_count = sum(count))

# calculate percentages
waterfront_percentages <- waterfront_counts_by_city_landcode |>
  left_join(total_counts_by_city, by = "city") |>
  mutate(percentage = (count / total_count) * 100)

# View the result
print(waterfront_percentages)

#export
write.csv(waterfront_percentages, "waterfront_percentages.csv", row.names = FALSE)
```
I thought it would be cool to show pies for each city in datawrapper, but it didn't work. I'm going to see if it will work if I elimate the cities with only one landcode.
update: It doesn't.

```{r}
waterfront_landcodes <- waterfront_percentages |>
  group_by(city) |>
  filter(n_distinct(land_code) > 1)

# View the resulting DataFrame
print(waterfront_landcodes)

#export
write.csv(waterfront_landcodes, "waterfront_landcodes.csv", row.names = FALSE)
```

Let's look at land codes in general:
81 percent of the transactions are residential. 

Here's a visualization of landcodes that aren't residential: https://datawrapper.dwcdn.net/49Hc3/1/


```{r}

# count land code
land_code_counts <- property_renamed |>
  count(land_code)

# total 
total_records <- nrow(property_renamed)

# percentages
land_code_percentages <- land_code_counts |>
  mutate(percentage = n / total_records * 100)

# view
print(land_code_percentages)

#export
write.csv(land_code_percentages, "land_code_percentages.csv", row.names = FALSE)

```
```{r}
#see non-residential only

non_residential <- property_renamed |>
  filter(land_code != "Residential (R)" , land_code != "Residential Condominium (U)")

# count
land_code_counts_non <- non_residential |>
  count(land_code)

# number of non-residential records
total_non_residential <- nrow(non_residential)

# percentages
land_code_percentages_non <- land_code_counts_non |>
  mutate(percentage = n / total_non_residential * 100)

# view the land code percentages
print(land_code_percentages_non)

#export
write.csv(land_code_percentages_non, "land_code_percentages_non.csv", row.names = FALSE)

```

Let's see owner trends. Looking at most recent transactions first (sales3)

```{r}

# count properties per owner
owners_count <- property_renamed |>
  count(sales3) |>
  filter(n > 1) |>
  arrange(desc(n))

# view
print(owners_count)

```

